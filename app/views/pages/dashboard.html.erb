<div class="container">

  <% @itineraries = Itinerary.where(user_id: current_user.id) %>
  <% @favorites = Favorite.where(user_id: current_user.id)%>

  <div>
    <%= cl_image_tag current_user.photo.key, 
    width: 50, 
    height: 50, 
    gravity: :auto, 
    crop: :fill, 
    radius: :max, 
    class: "avatar dropdown-toggle", 
    id: "navbarDropdown", 
    data: { bs_toggle: "dropdown" }, 
    'aria-haspopup': true, 
    'aria-expanded': false %>

    <p><%= current_user.first_name %> <%= current_user.last_name %></p>

    <div>
      <div>
        <p><%= @itineraries.count %></p>
        <% if @itineraries.count == 1%>
          <p>Itinerary</p>
        <% else %>
          <p>Itineraries</p>
        <% end %>
      </div>

      <div>
        <p><%= @favorites.count %></p>
        <% if @favorites.count == 1%>
          <p>Favorite</p>
        <% else %>
          <p>Favorites</p>
        <% end %>

      </div>
    </div>

    <%= link_to "New itinerary", new_itinerary_path, class: "btn-pink" %>
  </div>

  <div>
    <h2> My favorites </h2>
    <%= render "shared/user_itineraries" %>
  </div>

  <div>
    <h2> My itineraries</h2>

    <% if @itineraries.length != 0 %>
      
      <div class="itineraries-card">

        <% @itineraries.each do |itinerary| %>

          <div class="itinerary-card">
          
            <div class="itinerary-info-card">

              <% if itinerary.activities.present? %>
                <% if itinerary.activities.first.photo.key.present? %>
                  <%= cl_image_tag itinerary.activities.first.photo.key, height: 420, width: 296, crop: :fill, style: :background, class: "activity-photo" %>
                <% end %>
              <% end %>

              <div class="itinerary-title-card">
                <h3> <strong> <%= link_to "#{itinerary.title}", itinerary_path(itinerary) %></strong> </h3>
                <%= link_to "See more", itinerary_path(itinerary), class: "submit-btn" %>
                <%= link_to "Add to favorites", itinerary_favorites_path(itinerary), data: { turbo_method: :post, turbo_confirm: "Are you sure?" }, class: "submit-btn" %>
              </div>
              <p>Station : <%= itinerary.station.name %></p>
              <p> Rating : <%= itinerary.rating %></p>
              <p> Description : <%= itinerary.description %></p>
              <p> Price : <%= itinerary.price %></p>
              <p> Duration : <%= itinerary.duration %></p>
              <p> weather :
                <% if itinerary.sunny == true  %>
                  <i class="fa-solid fa-sun"></i>
                <% end  %>
                <% if itinerary.rainy == true  %>
                  <i class="fa-solid fa-cloud-rain"></i>
                <% end  %>
                <% if itinerary.cloudy == true  %>
                  <i class="fa-solid fa-cloud-sun"></i>
                <% end  %>
              </p>

              <p> Categories :
                <% if itinerary.restaurant == true  %>
                  <i class="fa-solid fa-utensils"></i>
                <% end  %>
                <% if itinerary.culture == true  %>
                  <i class="fa-solid fa-palette"></i>
                <% end  %>
                <% if itinerary.drinks == true  %>
                  <i class="fa-solid fa-champagne-glasses"></i>
                <% end  %>
                <% if itinerary.outdoor == true  %>
                  <i class="fa-solid fa-tree-city"></i>
                <% end  %>
                <% if itinerary.original == true  %>
                  <i class="fa-solid fa-face-grin-stars"></i>
                <% end  %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
  
    <% else %>

      <div class="no-itinerary-card">
        <h3>No itineraries added... yet!</h3>
        <p>It's time to go out and get ready for your next date.</p>
        <%= link_to "Start searching", itineraries_path, class: "btn-itinerary-index" %>
      </div>

    <% end %>
  </div>

</div>
